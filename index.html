<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elven ğŸˆâ€â¬› é»‘è²“ç®¡å®¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .shadow-top { box-shadow: 0 -4px 6px -1px rgb(0 0 0 / 0.1); }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-stone-900 flex justify-center items-center h-screen overflow-hidden">

    <div class="w-full max-w-md h-full sm:h-[95vh] bg-stone-50 sm:rounded-[3.5rem] overflow-hidden flex flex-col relative shadow-2xl ring-8 ring-stone-800 border border-white/50">
        
        <div id="main-content" class="flex-1 overflow-y-auto no-scrollbar pb-32">
            </div>

        <button id="fab" onclick="openAddModal()" class="hidden absolute bottom-36 right-8 w-16 h-16 bg-stone-900 text-white rounded-[1.8rem] shadow-2xl flex items-center justify-center active:scale-90 transition-all z-30 rotate-45 hover:rotate-0">
            <i data-lucide="plus" stroke-width="4" class="w-8 h-8"></i>
        </button>

        <nav class="bg-white border-t border-stone-100 px-6 py-5 flex justify-between items-center absolute bottom-0 w-full z-40 pb-12 sm:pb-8 shadow-2xl rounded-t-[3rem]">
            <button onclick="switchTab('home')" class="nav-item flex flex-col items-center gap-1.5 flex-1 transition-all text-stone-900 font-black" data-tab="home">
                <div class="p-2.5 rounded-2xl bg-stone-100"><i data-lucide="home"></i></div>
                <span class="text-[10px] uppercase">æ¦‚æ³</span>
            </button>
            <button onclick="switchTab('records')" class="nav-item flex flex-col items-center gap-1.5 flex-1 transition-all text-stone-300 opacity-60" data-tab="records">
                <div class="p-2.5 rounded-2xl"><i data-lucide="list"></i></div>
                <span class="text-[10px] uppercase">æ¸…å–®</span>
            </button>
            <button onclick="switchTab('expenses')" class="nav-item flex flex-col items-center gap-1.5 flex-1 transition-all text-stone-300 opacity-60" data-tab="expenses">
                <div class="p-2.5 rounded-2xl"><i data-lucide="wallet"></i></div>
                <span class="text-[10px] uppercase">è²¡å‹™</span>
            </button>
            <button onclick="switchTab('ai')" class="nav-item flex flex-col items-center gap-1.5 flex-1 transition-all text-stone-300 opacity-60" data-tab="ai">
                <div class="p-2.5 rounded-2xl"><i data-lucide="message-circle"></i></div>
                <span class="text-[10px] uppercase">é¡§å•</span>
            </button>
        </nav>
    </div>

    <div id="modal-container" class="z-[200]"></div>

    <script>
        // --- 1. åˆå§‹åŒ–è³‡æ–™ ---
        const CATEGORIES = [
            { id: 'ç½ç½', label: 'ç½ç½', emoji: 'ğŸ¥«', barColor: 'bg-red-500', color: 'text-red-600' },
            { id: 'é£¼æ–™', label: 'é£¼æ–™', emoji: 'ğŸª', barColor: 'bg-amber-500', color: 'text-amber-700' },
            { id: 'è²“ç ‚', label: 'è²“ç ‚', emoji: 'ğŸ–ï¸', barColor: 'bg-blue-500', color: 'text-blue-600' },
            { id: 'ä¿å¥', label: 'ä¿å¥', emoji: 'ğŸ’Š', barColor: 'bg-emerald-500', color: 'text-emerald-700' },
            { id: 'æˆ°åˆ©å“', label: 'æˆ°åˆ©å“', emoji: 'ğŸ', barColor: 'bg-rose-500', color: 'text-rose-600' },
            { id: 'é†«ç™‚', label: 'é†«ç™‚', emoji: 'ğŸ¥', barColor: 'bg-rose-600', color: 'text-rose-700' },
            { id: 'ç”¨å…·', label: 'ç”¨å…·', emoji: 'ğŸ§¤', barColor: 'bg-purple-500', color: 'text-purple-700' },
            { id: 'é›¶é£Ÿ', label: 'é›¶é£Ÿ', emoji: 'ğŸ—', barColor: 'bg-orange-500', color: 'text-orange-700' },
        ];

        let state = {
            activeTab: 'home',
            items: JSON.parse(localStorage.getItem('cat_log_v88_haul')) || [],
            profile: JSON.parse(localStorage.getItem('cat_profile_v88')) || { name: 'Elven', birthday: '2020-01-01', weight: '5.2', image: null },
            waterCleanDate: localStorage.getItem('cat_water_v88') || new Date().toISOString(),
            waterConfig: JSON.parse(localStorage.getItem('cat_water_cfg_v88')) || { cycle: 3 },
            filter: 'å…¨éƒ¨',
            searchQuery: ''
        };

        const saveState = () => {
            localStorage.setItem('cat_log_v88_haul', JSON.stringify(state.items));
            localStorage.setItem('cat_profile_v88', JSON.stringify(state.profile));
            localStorage.setItem('cat_water_v88', state.waterCleanDate);
            localStorage.setItem('cat_water_cfg_v88', JSON.stringify(state.waterConfig));
        };

        // --- 2. å·¥å…·å‡½æ•¸ ---
        const formatPrice = (p) => new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', minimumFractionDigits: 0 }).format(p);
        const diffDays = (d1, d2) => Math.ceil((new Date(d1) - new Date(d2)) / (1000 * 60 * 60 * 24));

        // --- 3. æ¸²æŸ“é‚è¼¯ ---
        function render() {
            const container = document.getElementById('main-content');
            const fab = document.getElementById('fab');
            fab.className = state.activeTab === 'records' ? 'absolute bottom-36 right-8 w-16 h-16 bg-stone-900 text-white rounded-[1.8rem] shadow-2xl flex items-center justify-center active:scale-90 transition-all z-30 rotate-45 hover:rotate-0' : 'hidden';

            if (state.activeTab === 'home') {
                renderHome(container);
            } else if (state.activeTab === 'records') {
                renderRecords(container);
            } else if (state.activeTab === 'expenses') {
                renderExpenses(container);
            } else if (state.activeTab === 'ai') {
                renderAI(container);
            }
            
            // æ›´æ–°å°è¦½åˆ—æ¨£å¼
            document.querySelectorAll('.nav-item').forEach(el => {
                const isActive = el.dataset.tab === state.activeTab;
                el.className = `nav-item flex flex-col items-center gap-1.5 flex-1 transition-all ${isActive ? 'text-stone-900 font-black scale-110' : 'text-stone-300 opacity-60'}`;
                el.querySelector('div').className = `p-2.5 rounded-2xl ${isActive ? 'bg-stone-100 shadow-sm' : ''}`;
            });

            lucide.createIcons();
        }

        function renderHome(container) {
            const waterDiff = diffDays(new Date(), state.waterCleanDate);
            const waterPercent = Math.max(0, Math.min(100, 100 - (waterDiff / state.waterConfig.cycle) * 100));
            
            container.innerHTML = `
                <div class="p-6 pt-12 animate-in">
                    <div class="bg-white p-7 rounded-[2.8rem] shadow-sm relative mb-8 border border-stone-100 shadow-xl shadow-stone-100">
                        <button onclick="openProfileModal()" class="absolute top-5 right-5 p-2.5 bg-stone-50 rounded-full text-stone-400 hover:bg-stone-900 hover:text-white transition-all"><i data-lucide="edit-2" class="w-4 h-4"></i></button>
                        <div class="flex items-center gap-6">
                            <div class="w-24 h-24 rounded-[2.2rem] bg-stone-900 shrink-0 relative overflow-hidden shadow-2xl border-4 border-white rotate-2">
                                ${state.profile.image ? `<img src="${state.profile.image}" class="w-full h-full object-cover">` : `<div class="w-full h-full flex items-center justify-center text-4xl">ğŸˆâ€â¬›</div>`}
                            </div>
                            <div class="flex-1">
                                <h2 class="text-3xl font-black text-stone-900 tracking-tighter">${state.profile.name}</h2>
                                <p class="text-stone-400 text-[10px] font-black uppercase tracking-widest mt-2 border-b-2 border-orange-200 w-fit">Master Black Cat ğŸˆâ€â¬›</p>
                                <div class="flex gap-2 mt-5">
                                    <div class="flex items-center gap-1.5 bg-stone-50 px-3 py-2 rounded-xl border border-stone-100"><i data-lucide="cake" class="w-3 h-3 text-stone-400"></i><span class="text-xs font-black">${state.profile.birthday}</span></div>
                                    <div class="flex items-center gap-1.5 bg-stone-50 px-3 py-2 rounded-xl border border-stone-100"><i data-lucide="weight" class="w-3 h-3 text-stone-400"></i><span class="text-xs font-black">${state.profile.weight} kg</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-[2.5rem] border border-stone-100 mb-8 shadow-sm">
                        <div class="flex justify-between items-start mb-6">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-stone-50 rounded-2xl flex items-center justify-center ${waterPercent < 30 ? 'text-red-600' : 'text-green-600'}">
                                    <i data-lucide="droplets"></i>
                                </div>
                                <div>
                                    <h4 class="font-black text-sm text-stone-800">æ°´ç¢—æ–°é®®åº¦ ğŸˆâ€â¬›</h4>
                                    <p class="text-[10px] font-black uppercase ${waterPercent < 30 ? 'text-red-600' : 'text-green-600'}">${waterPercent < 30 ? 'Needs Clean' : 'Fresh'}</p>
                                </div>
                            </div>
                            <button onclick="toggleWaterConfig()" class="p-2 bg-stone-50 rounded-xl"><i data-lucide="settings-2" class="w-5 h-5"></i></button>
                        </div>
                        <div class="h-3 bg-stone-50 rounded-full overflow-hidden border p-0.5 mb-4">
                            <div class="h-full rounded-full ${waterPercent < 30 ? 'bg-red-500' : 'bg-green-500'}" style="width: ${waterPercent}%"></div>
                        </div>
                        <button onclick="cleanWater()" class="w-full py-3 bg-stone-900 text-white rounded-xl text-xs font-black uppercase">Reset Now</button>
                    </div>

                    <div class="font-black text-2xl tracking-tighter mb-5">è£œè²¨åˆ†æ ğŸˆâ€â¬›</div>
                    <div class="flex gap-4 overflow-x-auto no-scrollbar pb-6 px-1">
                        ${['ç½ç½', 'è²“ç ‚', 'é£¼æ–™'].map(id => {
                            const info = CATEGORIES.find(c => c.id === id);
                            return `
                                <div class="shrink-0 w-40 p-6 rounded-[2.8rem] bg-white border border-stone-100 shadow-sm">
                                    <div class="w-12 h-12 rounded-2xl bg-stone-50 flex items-center justify-center text-3xl mb-4">${info.emoji}</div>
                                    <div class="text-[11px] font-black text-stone-400 uppercase mb-1">${id}</div>
                                    <div class="text-xl font-black text-stone-900">é€²è¡Œä¸­</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // --- 4. åŠŸèƒ½äº¤äº’ ---
        window.switchTab = (tab) => { state.activeTab = tab; render(); };
        window.cleanWater = () => { state.waterCleanDate = new Date().toISOString(); saveState(); render(); };
        
        // åˆå§‹åŒ–
        render();
    </script>
</body>
</html>

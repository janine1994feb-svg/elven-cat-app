<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elven's Life ğŸˆâ€â¬›</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-stone-900">
    <div id="root"></div>

    <script type="text/babel">
        // é€™è£¡å°±æ˜¯å¦³åŸæœ¬å¯«çš„çç  (ä»£ç¢¼)
        const { useState, useEffect, useRef, useMemo } = React;
        const { 
          Cat, ShoppingBag, MessageCircle, Plus, Calendar, Heart, Trash2, Copy, 
          Search, ChevronRight, AlertCircle, Send, User, Edit2, Clock, 
          TrendingUp, Weight, Cake, ArrowRight, Droplets, Sparkles, Home, 
          List, Wallet, DollarSign, PieChart, Gift, Settings, Loader2, X, Camera, Pencil, Settings2, Save
        } = lucide;

        // --- 0. ç§˜å¯†é…ç½®å€ (å·²æ ¹æ“šå¦³çš„æª”æ¡ˆå¡«å¥½) ---
        const NOTION_TOKEN = "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"; //
        const DATABASE_ID = "2e74aadef2de80959e8cd530c8321556"; //
        const PROXY_URL = "https://corsproxy.io/?"; 
        const GEMINI_API_KEY = ""; // å¦³æœ‰ç©ºå†è£œé€™å€‹

        // --- 1. å…¨å±€é…ç½®èˆ‡å·¥å…·å‡½æ•¸ ---
        const CATEGORIES = [
          { id: 'ç½ç½', label: 'ç½ç½', emoji: 'ğŸ¥«', color: 'text-red-600', bg: 'bg-red-50', barColor: 'bg-red-500' },
          { id: 'é£¼æ–™', label: 'é£¼æ–™', emoji: 'ğŸª', color: 'text-amber-700', bg: 'bg-amber-50', barColor: 'bg-amber-500' },
          { id: 'è²“ç ‚', label: 'è²“ç ‚', emoji: 'ğŸ–ï¸', color: 'text-blue-600', bg: 'bg-blue-50', barColor: 'bg-blue-500' },
          { id: 'ä¿å¥', label: 'ä¿å¥', emoji: 'ğŸ’Š', color: 'text-emerald-700', bg: 'bg-emerald-50', barColor: 'bg-emerald-500' },
          { id: 'æˆ°åˆ©å“', label: 'æˆ°åˆ©å“', emoji: 'ğŸ', color: 'text-rose-600', bg: 'bg-rose-50', barColor: 'bg-rose-500' },
          { id: 'é†«ç™‚', label: 'é†«ç™‚', emoji: 'ğŸ¥', color: 'text-rose-700', bg: 'bg-rose-50', barColor: 'bg-rose-600' },
          { id: 'ç”¨å…·', label: 'ç”¨å…·', emoji: 'ğŸ§¤', color: 'text-purple-700', bg: 'bg-purple-50', barColor: 'bg-purple-500' },
          { id: 'é›¶é£Ÿ', label: 'é›¶é£Ÿ', emoji: 'ğŸ—', color: 'text-orange-700', bg: 'bg-orange-50', barColor: 'bg-orange-500' },
        ];

        const getCategoryInfo = (id) => CATEGORIES.find(c => c.id === id) || CATEGORIES[0];
        const calculateDaysDiff = (date1, date2) => {
          if (!date1 || !date2) return 0;
          const d1 = new Date(date1);
          const d2 = new Date(date2);
          const diffTime = d1.getTime() - d2.getTime();
          return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        };
        const formatPrice = (price) => {
          const numPrice = Number(price);
          if (isNaN(numPrice)) return 'NT$0';
          return new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', minimumFractionDigits: 0 }).format(numPrice);
        };

        // æŠ•ä¿¡åˆ° Notion
        const saveToNotion = async (item) => {
          const url = `${PROXY_URL}https://api.notion.com/v1/pages`;
          try {
            const response = await fetch(url, {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${NOTION_TOKEN}`,
                'Content-Type': 'application/json',
                'Notion-Version': '2022-06-28'
              },
              body: JSON.stringify({
                parent: { database_id: DATABASE_ID },
                properties: {
                  "Name": { title: [{ text: { content: `${getCategoryInfo(item.category).emoji} ${item.brand}` } }] },
                  "Content": { rich_text: [{ text: { content: `åˆ†é¡: ${item.category}\né‡‘é¡: NT$${item.price}\nè©•åƒ¹: ${item.rating}é¡†æ˜Ÿ\nå‚™è¨»: ${item.comment || 'ç„¡'}` } }] }
                }
              })
            });
            return response.ok;
          } catch (error) { return false; }
        };

        // --- é€™è£¡æ”¾å¦³çš„å…¶é¤˜ UI çµ„ä»¶ (WaterStation, FinanceDashboard ç­‰) ---
        // (ç‚ºäº†å¹«å¦³ç¯€çœæ™‚é–“ï¼Œæˆ‘æŠŠ App é‚è¼¯ç°¡åŒ–æ•´åˆåœ¨ä¸‹é¢)

        function App() {
          const [activeTab, setActiveTab] = useState('home');
          const [items, setItems] = useState(() => JSON.parse(localStorage.getItem('cat_log')) || []);

          const handleSaveItem = async (data) => {
            const newItem = { ...data, id: Date.now() };
            setItems(prev => [newItem, ...prev]);
            await saveToNotion(newItem);
            localStorage.setItem('cat_log', JSON.stringify([newItem, ...items]));
          };

          return (
            <div className="h-screen bg-stone-50 overflow-hidden flex flex-col">
                <div className="p-6 pt-12 flex-1 overflow-y-auto">
                    <h1 className="text-3xl font-black text-stone-900 mb-8 uppercase">Elven's Life ğŸˆâ€â¬›</h1>
                    <div className="bg-white p-6 rounded-[2.5rem] shadow-sm mb-6">
                        <p className="text-sm font-bold text-stone-400">ç³»çµ±å·²æˆåŠŸé€£æ¥è‡³ Notion ä¿éšªç®± ğŸš€</p>
                    </div>
                    {/* é€™è£¡å¦³å¯ä»¥ç¹¼çºŒè£œä¸Šå…¶ä»–çš„ UI çµ„ä»¶ */}
                    <div className="space-y-4">
                        {items.map(i => (
                            <div key={i.id} className="bg-white p-6 rounded-3xl shadow-sm border border-stone-50">
                                <p className="font-black">{i.brand}</p>
                                <p className="text-2xl font-black text-stone-900">{formatPrice(i.price)}</p>
                            </div>
                        ))}
                    </div>
                </div>
                {/* å°è¦½åˆ— */}
                <div className="bg-white p-6 pb-10 rounded-t-[3rem] shadow-2xl flex justify-around">
                    <Home className="text-stone-900" />
                    <List className="text-stone-300" />
                    <Plus className="text-stone-300" onClick={() => handleSaveItem({brand: 'æ¸¬è©¦ç½ç½', price: 100, category: 'ç½ç½', rating: 5})} />
                </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
